<audio id="player" controls crossorigin="anonymous" volume="1" muted="false"></audio>

<script>
const tracks = [
  "Echoes of You.mp3",
  "Memory Loops.mp3",
  "Us, Finally.mp3"
];

const CloudRunBase = "https://music-server-777936161804.europe-west1.run.app/music/";

const trackListDiv = document.getElementById("trackList");
const player = document.getElementById("player");
player.volume = 1.0;
player.muted = false;

let currentBtn = null;
let currentTrackDiv = null;

tracks.forEach(filename=>{
  const encoded = encodeURIComponent(filename);
  const div = document.createElement("div");
  div.className="track";

  const name = document.createElement("span");
  name.textContent = filename.replace(".mp3","");

  const controls = document.createElement("div");
  controls.className="track-controls";

  const btn = document.createElement("button");
  btn.textContent="Play";

  btn.onclick = async () => {
    if(player.src.includes(encoded) && !player.paused){
      player.pause();
      btn.textContent="Play";
      div.classList.remove("active");
      return;
    }

    player.src = CloudRunBase + encoded;
    player.play();

    if(currentBtn) currentBtn.textContent="Play";
    if(currentTrackDiv) currentTrackDiv.classList.remove("active");

    btn.textContent="Pause";
    div.classList.add("active");
    currentBtn = btn;
    currentTrackDiv = div;
  };

  controls.appendChild(btn);
  div.appendChild(name);
  div.appendChild(controls);
  trackListDiv.appendChild(div);
});

player.onended = () => {
  if(currentBtn) currentBtn.textContent="Play";
  if(currentTrackDiv) currentTrackDiv.classList.remove("active");
};
</script>
