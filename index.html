<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Music Player</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .track {
      background: #1e1e1e;
      padding: 8px 12px;   /* 기존보다 50% 적은 높이 */
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    /* 상단 라인: Play/Pause + EQ */
    .top-row {
      display: flex;
      align-items: center;
      justify-content: space-between; /* 좌/우 정렬 */
      gap: 12px;
    }

    button {
      background: #4CAF50;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      color: white;
      border-radius: 6px;
    }

    button:hover {
      background: #45a049;
    }

    /* EQ 슬라이더 세로 고정 크기 조정 */
    .eq-container {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .eq-slider {
      width: 60px;
    }
  </style>
</head>
<body>

<h1>My Music Player</h1>

<div id="track-list"></div>

<script>
const TRACKS = [
  "Memory Loops.mp3",
  "Echoes of You.mp3",
  "Us, Finally.mp3"
];

const API_BASE = "https://music-server-777936161804.europe-west1.run.app/music/";

let audioContext = new (window.AudioContext || window.webkitAudioContext)();
let currentSource = null;
let currentAudio = null;

function createTrackElement(filename) {
  const container = document.createElement("div");
  container.className = "track";

  const title = document.createElement("div");
  title.textContent = filename;

  const audio = document.createElement("audio");
  audio.src = API_BASE + encodeURIComponent(filename);
  audio.crossOrigin = "anonymous";  

  const playBtn = document.createElement("button");
  playBtn.textContent = "Play";

  // EQ (3-band)
  const eqContainer = document.createElement("div");
  eqContainer.className = "eq-container";

  const freqs = [100, 1000, 5000]; 
  const filters = freqs.map(f => {
    let filter = audioContext.createBiquadFilter();
    filter.type = "peaking";
    filter.frequency.value = f;
    filter.Q.value = 1;
    return filter;
  });

  filters.reduce((a, b) => (a.connect(b), b));

  const gainNodes = filters.map((filter, i) => {
    const slider = document.createElement("input");
    slider.type = "range";
    slider.min = -15;
    slider.max = 15;
    slider.value = 0;
    slider.className = "eq-slider";

    slider.addEventListener("input", () => {
      filter.gain.value = slider.value;
    });

    eqContainer.appendChild(slider);
    return slider;
  });

  playBtn.onclick = () => {
    if (currentAudio && currentAudio !== audio) {
      currentAudio.pause();
      if (currentSource) currentSource.disconnect();
    }

    if (audio.paused) {
      audio.play().then(() => {
        if (currentSource) currentSource.disconnect();
        currentSource = audioContext.createMediaElementSource(audio);
        currentSource.connect(filters[0]);
        filters[filters.length - 1].connect(audioContext.destination);
      });
      playBtn.textContent = "Pause";
      currentAudio = audio;
    } else {
      audio.pause();
      playBtn.textContent = "Play";
    }
  };

  const topRow = document.createElement("div");
  topRow.className = "top-row";
  topRow.appendChild(playBtn);
  topRow.appendChild(eqContainer);

  container.appendChild(title);
  container.appendChild(topRow);
  return container;
}

TRACKS.forEach(file => {
  document.getElementById("track-list").appendChild(createTrackElement(file));
});
</script>
</body>
</html>
