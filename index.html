<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Music Player + PayPal + Equalizer</title>
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#00c2ff;
    --text:#e6eef8;
    --muted:#95a3b6;
  }
  body { margin:0; padding:40px; font-family:Inter,Segoe UI,Arial,sans-serif;
    background:linear-gradient(180deg,#071029 0%,#071726 60%); color:var(--text); }
  h1{text-align:center;margin-bottom:30px;font-weight:600;}
  .track-list{max-width:700px;margin:0 auto;}
  .track{display:flex;justify-content:space-between;align-items:center;
    background:var(--card);padding:16px 18px;border-radius:12px;margin-bottom:14px;
    border:1px solid rgba(255,255,255,0.04);transition:0.25s;}
  .track.active{border:1px solid var(--accent);box-shadow:0 0 14px rgba(0,194,255,0.4);}
  button{background:var(--accent);border:none;border-radius:8px;padding:8px 18px;color:#06202b;font-weight:600;cursor:pointer;transition:.2s;}
  button:hover{filter:brightness(1.15);}  
  audio{width:100%;max-width:700px;display:block;margin:35px auto 0;} 

  /* Equalizer */
  #eqCanvas {width:100%;max-width:700px;height:160px;
    background:#000;border:2px solid #333;border-radius:12px;margin:25px auto 0;display:block;}
</style>
</head>
<body>
<h1>Music Player</h1>
<div class="track-list" id="trackList"></div>
<audio id="player" controls></audio>

<!-- Equalizer Canvas MUST have width/height attributes -->
<canvas id="eqCanvas" width="700" height="160"></canvas>

<div class="pay-section" style="max-width:700px;margin:50px auto;padding:22px;background:var(--card);border-radius:14px;border:1px solid rgba(255,255,255,0.04);text-align:center;">
  <div class="price" style="font-size:20px;margin-bottom:10px;font-weight:600;">$4.99</div>
  <div class="desc" style="color:var(--muted);font-size:14px;margin-bottom:20px;">Unlock full-quality downloads + commercial license.</div>
  <div id="paypal-button-container"></div>
</div>

<script>
const tracks = [
  "Echoes of You.mp3",
  "Memory Loops.mp3",
  "Us, Finally.mp3"
];

const list = document.getElementById("trackList");
const player = document.getElementById("player");
const canvas = document.getElementById("eqCanvas");
const ctx = canvas.getContext("2d");

let audioCtx, analyser, srcNode;
let curBtn=null, curDiv=null;

function initEQ(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    analyser = audioCtx.createAnalyser();
    analyser.fftSize = 128; // smoother bars
  }
  if(srcNode) srcNode.disconnect();

  srcNode = audioCtx.createMediaElementSource(player);
  srcNode.connect(analyser);
  analyser.connect(audioCtx.destination);

  drawEQ();
}

function drawEQ(){
  const data = new Uint8Array(analyser.frequencyBinCount);
  function loop(){
    requestAnimationFrame(loop);
    analyser.getByteFrequencyData(data);

    ctx.clearRect(0,0,canvas.width,canvas.height);
    const barW = (canvas.width / data.length) - 2;
    let x = 0;

    for(let i=0;i<data.length;i++){
      const h = data[i] * 1.2;
      ctx.fillStyle = `rgb(${h+40},150,255)`;
      ctx.fillRect(x, canvas.height - h, barW, h);
      x += barW + 2;
    }
  }
  loop();
}

tracks.forEach(f => {
  const encoded = "music/" + encodeURIComponent(f);
  const div = document.createElement("div");
  div.className="track";
  const name = document.createElement("span");
  name.textContent = f.replace(".mp3", "");
  const btn = document.createElement("button");
  btn.textContent = "Play";

  btn.onclick = async () => {
    if(player.src.includes(encoded) && !player.paused){
      player.pause();
      btn.textContent="Play";
      div.classList.remove("active");
      return;
    }

    player.src = encoded;

    if(audioCtx && audioCtx.state === "suspended"){
      await audioCtx.resume();
    }

    player.play().then(() => {
      initEQ();
      if(curBtn) curBtn.textContent="Play";
      if(curDiv) curDiv.classList.remove("active");
      btn.textContent="Pause";
      div.classList.add("active");
      curBtn=btn;
      curDiv=div;
    });
  };

  div.append(name, btn);
  list.appendChild(div);
});

player.onended = () => {
  if(curBtn) curBtn.textContent="Play";
  if(curDiv) curDiv.classList.remove("active");
};
</script>

<script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID&currency=USD"></script>
<script>
paypal.Buttons({
  createOrder:(d,a)=>a.order.create({purchase_units:[{amount:{value:'4.99'}}]}),
  onApprove:(d,a)=>a.order.capture().then(n=>alert('Payment completed!'))
}).render('#paypal-button-container');
</script>
</body>
</html>
